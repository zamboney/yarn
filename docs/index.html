<html>
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.4.1/css/reveal.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.4.1/css/theme/simple.min.css">
    <style>
        code {
            padding: 0;
            padding-top: 0.2em;
            padding-bottom: 0.2em;
            margin: 0;
            font-size: 85%;
            background-color: rgba(0, 0, 0, 0.04);
            border-radius: 3px;
        }

        code:before {
            letter-spacing: -0.2em;
            content: "\00a0";

        }

        code:after {
            letter-spacing: -0.2em;
            content: "\00a0";
        }
    </style>
</head>
<body>
<div class="reveal">
    <div class="slides">
        <section data-markdown
                 data-separator="^\n\n\n"
                 data-separator-vertical="^\n\n">

            <script type="text/template">
                ##From NPM to Yarn



                ###what is NPM


                **NPM** stand for "**N**ode **P**ackage **M**anger" and it's come to handle node modules, from a remote and local repository, so that can distributed to other.


                NPM isn't the only package manger system, there is a lot other like:
                - PIP for python
                - Nuget for C#
                - JSM for Java
                - etc...


                The default repository that NPM set out of the box is https://registry.npmjs.org, and his site is https://www.npmjs.com

                (in this lecture we will use a local repository call [**sinopia**](https://www.npmjs.com/package/sinopia))



                ###Create and Publish Packages


                #### `package.json`
                * the manifest of each package is `package.json` file.
                * this file contain the metadata of the package.
                * the metadata contain a lot of properties, like name, version, description and etc... of the package.
                * we will focus on `dependencies` property.


                to create a `package.json` file just run `npm init` in the command promote, this will start to ask you question about you package and place them in the file

                (`npm init -f` will auto replay the question and just create the `package.json`)


                #### package.json `dependencies` (1/2)
                * this property define list of **dependencies** for this package.
                * it's a key value object:
                    * the key represent the name of the the package.
                    * the value is the version of the package.
                * the version system known as [`node semver.inc`](https://github.com/npm/node-semver).


                ####node semver [advanced-range-syntax](https://github.com/npm/node-semver#advanced-range-syntax)
                * this method of visioning using to auto update the version of the package.
                * by using a `^` or `~` on the beginning of the `version` value the `node semver` will auto update the packages on the next `npm install`.
                * [read more](https://github.com/npm/node-semver#advanced-range-syntax)


                #### package.json `dependencies` (2/2)
                * there are types of dependencies like `devDependencies` and `peerDependencies` (out of this lecture scope).
                * add a new dependency to the package by running `npm install < package-name> --save`.
                * installing the dependencies by running `npm install` on the folder that contain the `package.json`


                #### package.json `dependencies` example
                ```
                    {
                        "name": "guessing-game-ui",
                        "version": "1.0.0",
                        "description": "",
                        "main": "index.js",
                        "author": "",
                        "license": "ISC",
                        "dependencies": {
                            "guessing-game-logic": "^1.0.1"
                        }
                    }
                ```


                #### Publish package (1/2)
                * create an account in the repository (per repertory out of scope), done once per account.
                * register the account in the machine, done once per machine.
                    * run `npm adduser` and enter the username and password.


                #### Publish package (2/2)
                * `npm publish`.
                    * this command upload the package to the repertory.
                    * package wouldn't upload if there is another package with the same **name and version**.
                    * to solve this use `npm version major | minor | patch | etc..`. this will update the version by the argument. then use `npm publish`.


                ### DEMO



                ## `yarn` introduction.


                ### What is `yarn`?
                * `yarn`, just like `npm`, is a JavaScript package manger.
                * `yarn` solve some issues that `npm` have.
                * `yarn` can use `npm` repositories (so no need to create new repository just for `yarn`)
                * develop by **Facebook** with **Google**


                ### Why using `yarn`?
                * more fast.
                * more reliable.
                * more secure.


                ### Start using `yarn`.
                1. download nodejs and `npm`.
                2. run (as administrator) `npm install --global yarn`.
                3. run `yarn --version`.
                4. that it! ([for more info](https://yarnpkg.com/en/docs/install))


                ### `npm` vs `yarn` commands

                | NPM | YARN |
                | ----| ---- |
                |`npm install`| `yarn`|
                |`npm install rxjs --save`| `yarn add rxjs`|
                |`npm uninstall rxjs --save`| `yarn remove rxjs`|
                |`npm install rxjs --global`| `npm install rxjs --global`|
                |`npm update --save`| `yarn upgrade`|


                ### `npm`, `yarn` common commands
                * `init`
                * `publish`
                * `run`
                * `cache clean`
                * `login`
                * `test`



                ## Why `yarn` fast.


                `npm install` is a long process. the reason for that is that `npm install` work one by one (download and build one package at a time).

                although `npm` have a cache mechanism, `npm install` must have an internet connection to get the package dependencies.


                `yarn` don't work like `npm`.

                `yarn` download the dependencies parallel and store all of them in a cache folder that reachable offline.

                * once `yarn` call
                * for dependencies that **hasn't** been cached, `yarn` will download them parallel, and store them in the cache folder.
                * for dependencies that **has** been cache, `yarn` will get them form the cache folder.


                ##[npm vs yarn speed test](https://github.com/appleboy/npm-vs-yarn)



                ## Why `yarn` reliable


                * `npm`, as mentioned before, using [`semver.inc`](https://github.com/npm/node-semver#prerelease-tags).
                * in `semver.inc` the upgrade done, according to the prefix, on every `npm install` command
                * this could create issues when trying to deliver the code or running it on remote machine (a.k.a. build machine)


                ###DEMO


                `npm` have a special command that solve this called [`npm shrinkwrap`](https://docs.npmjs.com/cli/shrinkwrap).

                what it does is generates a file called `npm-shrinkwrap.json` that specific the version that uses in package and when running `npm install` it will download the correct versions.


                ###DEMO


                that means that every time `npm install <package-name> --save` runs the develop will have to run `npm shrinkwrap` right after to generates the `npm-shrinkwrap.json` file again.


                ###DEMO


                `yarn` do this out of the box.

                every time `yarn add <package-name>` runs a file called `yarn.lock` generates that contain the metadata of the current package.

                so that the next running of `yarn` the `yarn` will know exactly what to download.


                ## But Wait!

                this could be easily solved just by removing the prefix of the version number on the `package.json`...

                <!-- .element: class="fragment" -->
                that is true but then the functionality of `npm update` will not work!

                <!-- .element: class="fragment" -->


                ###DEMO


                ## Why `yarn` security


                * `npm` can execute file, after install, using the `{scripts : {install: < command> }}`.
                * this means that `yarn`, before execute this script, do a *"checksums"* with a *sha-1* that place in a parameter on the dependency `yarn.lock`.
                * so if someone will try to switch the dns and hack to a npm repository, yarn will know that cause the *sha-1* in the repository isn't the some in the `yarn.lock` file.

            </script>
        </section>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.3.0/js/reveal.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.3.0/lib/js/head.min.js"></script>
<script>
    Reveal.initialize({
        history: true,
        slideNumber: true,
        dependencies: [
            {
                src: "https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.3.0/plugin/markdown/marked.min.js",
                condition: function () {
                    return !!document.querySelector('[data-markdown]');
                }
            },
            {
                src: "https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.3.0/plugin/markdown/markdown.min.js",
                condition: function () {
                    return !!document.querySelector('[data-markdown]');
                }
            }

        ]
    });
</script>
</body>
</html>